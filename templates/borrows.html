<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Quản lý thư viện</title>
</head>
<body>

<div style="margin-bottom: 20px;">
    <a href="/">📚 Quản lý sách</a> |
    <a href="/readers">👤 Quản lý độc giả</a> |
    <a href="/borrows">📖 Quản lý mượn – trả</a> |
    <a href="/stats">📊 Thống kê</a>
    {% if session.get('user_id') %}
        👤 Xin chào, {{ session.get('username') }} |
        <a href="#" onclick="confirmLogout()">🚪 Đăng xuất</a>

    {% else %}
        <a href="/login">🔐 Đăng nhập</a> |
        <a href="/register">📝 Đăng ký</a>
    {% endif %}
</div>

<hr>
<p><strong>📂 Bạn đang ở:</strong> Danh sách phiếu mượn</p>

<h1>📚 Quản lý thư viện</h1>
<a href="/borrow_form">➕ Tạo phiếu mượn</a>

<h2>Danh sách mượn – trả</h2>
<table border="1" cellpadding="5" cellspacing="0">
    <tr style="background-color: #f2f2f2;">
        <th>ID</th>
        <th>Độc giả</th>
        <th>Tên sách</th>
        <th>Ngày mượn</th>
        <th>Hạn trả</th>
        <th>Ngày trả</th>
        <th>Trạng thái</th>
        <th>Tiền phạt</th>

    </tr>
    {% for b in borrows %}
    <tr>
    <td>{{ b[0] }}</td>
    <td>{{ b[1] }}</td>
    <td>{{ b[2] }}</td>
    <td>{{ b[3] }}</td>
    <td>{{ b[4] }}</td>
    <td>{{ b[5] or '---' }}</td>
    <td>
    {{ b[6] }}
    {% if b[6] == 'Đang mượn' %}
        | <a href="/return_book/{{ b[0] }}" onclick="return confirm('Xác nhận trả sách?')">📥 Trả sách</a>
    {% elif b[6] == 'Đã trả' %}
        | <a href="/delete_borrow/{{ b[0] }}" onclick="return confirm('Xoá phiếu mượn này?')">🗑️ Xoá</a>
    {% endif %}
    </td>

    <td>{{ b[7] }} đ</td>

</tr>

    {% endfor %}
</table>
<script>
function confirmLogout() {
    const confirmBox = document.createElement("div");
    confirmBox.style.position = "fixed";
    confirmBox.style.top = "50%";
    confirmBox.style.left = "50%";
    confirmBox.style.transform = "translate(-50%, -50%)";
    confirmBox.style.background = "#fff";
    confirmBox.style.border = "2px solid #16a34a";
    confirmBox.style.padding = "30px";
    confirmBox.style.borderRadius = "12px";
    confirmBox.style.boxShadow = "0 10px 30px rgba(0, 0, 0, 0.15)";
    confirmBox.style.zIndex = "9999";
    confirmBox.style.textAlign = "center";
    confirmBox.style.minWidth = "320px";
    confirmBox.innerHTML = `
        <p style="font-size: 16px; margin-bottom: 20px;">
            <span style="font-size: 20px;">⚠️</span> Bạn có chắc chắn muốn đăng xuất?
        </p>
        <div style="display: flex; justify-content: center; gap: 20px;">
            <button onclick="window.location.href='/logout'" 
                style="background-color: #10b981; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                ✅ Có
            </button>
            <button onclick="this.closest('div').parentElement.remove()" 
                style="background-color: #ef4444; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                ❌ Không
            </button>
        </div>
    `;
    document.body.appendChild(confirmBox);
}
</script>


</body>
</html>
