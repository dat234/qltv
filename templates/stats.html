<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Th·ªëng k√™ th∆∞ vi·ªán</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}" />
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
        .statistics-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item, .detail-section {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .summary-item h2, .detail-section h2 {
            color: #333;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .summary-item ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .summary-item li {
            margin-bottom: 10px;
            color: #555;
        }

        .detail-section ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .detail-section li {
            margin-bottom: 8px;
            color: #555;
        }

        .detail-section h2 + ul {
            margin-top: 0;
        }

        .fine-revenue {
            margin-top: 20px;
            padding: 20px;
            background-color: #e6ffe6;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            color: #2e8b57;
            font-size: 1.1em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="library-name">üìö Qu·∫£n l√Ω th∆∞ vi·ªán</div>
        <div class="user-info">
            <span> Xin ch√†oüë§{{ session.get('username') }}</span>
            <button onclick="confirmLogout()">ƒêƒÉng xu·∫•t</button>
        </div>
    </header>
    <div class="content-wrapper">
        <nav class="sidebar">
            <a href="/" class="sidebar-item">
                <i class="fas fa-book"></i>
                <span>Qu·∫£n l√Ω s√°ch</span>
            </a>
            <a href="/readers" class="sidebar-item">
                <i class="fas fa-users"></i>
                <span>Qu·∫£n l√Ω ƒë·ªôc gi·∫£</span>
            </a>
            <a href="/borrows" class="sidebar-item">
                <i class="fas fa-receipt"></i>
                <span>Qu·∫£n l√Ω m∆∞·ª£n tr·∫£</span>
            </a>
            <a href="/stats" class="sidebar-item active">
                <i class="fas fa-chart-bar"></i>
                <span>Th·ªëng k√™</span>
            </a>
        </nav>
        <main class="main-content">
            <h1>üìä Th·ªëng k√™ th∆∞ vi·ªán</h1>
            <div class="statistics-container">
                <section class="summary-item">
                    <h2>T·ªïng quan</h2>
                    <ul>
                        <li>T·ªïng s·ªë s√°ch: <strong>{{ total_books }}</strong> cu·ªën</li>
                        <li>T·ªïng s·ªë ƒë·ªôc gi·∫£: <strong>{{ total_readers }}</strong> ng∆∞·ªùi</li>
                        <li>S√°ch ƒëang m∆∞·ª£n: <strong>{{ borrowed_books }}</strong> cu·ªën</li>
                        <li>S√°ch ƒë√£ tr·∫£: <strong>{{ returned_books }}</strong> cu·ªën</li>
                    </ul>
                </section>

                <section class="detail-section">
                    <h2>üìö S√°ch ƒë∆∞·ª£c m∆∞·ª£n nhi·ªÅu nh·∫•t</h2>
                    <ul>
                        {% for title, count in top_books %}
                        <li>{{ title }} ‚Äì {{ count }} l∆∞·ª£t</li>
                        {% endfor %}
                    </ul>
                </section>

                <section class="detail-section">
                    <h2>üë§ ƒê·ªôc gi·∫£ m∆∞·ª£n nhi·ªÅu nh·∫•t</h2>
                    <ul>
                        {% for name, count in top_readers %}
                        <li>{{ name }} ‚Äì {{ count }} l∆∞·ª£t</li>
                        {% endfor %}
                    </ul>
                </section>

                <section class="detail-section">
                    <h2>üìÖ S·ªë l∆∞·ª£t m∆∞·ª£n theo th√°ng</h2>
                    <ul>
                        {% for month, count in monthly_stats %}
                        <li>{{ month }} ‚Äì {{ count }} l∆∞·ª£t</li>
                        {% endfor %}
                    </ul>
                </section>
            </div>

            <section class="fine-revenue">
                <h2>üí∞ Doanh thu t·ª´ ph√≠ ph·∫°t</h2>
                <p>T·ªïng doanh thu: <strong>{{ fine_revenue }}</strong> ƒë</p>
            </section>

        </main>
    </div>

    <script>
        function confirmLogout() {
            if (document.getElementById("logoutOverlay")) return;
            const overlay = document.createElement("div");
            overlay.id = "logoutOverlay";
            overlay.style.position = "fixed";
            overlay.style.top = "0";
            overlay.style.left = "0";
            overlay.style.width = "100%";
            overlay.style.height = "100%";
            overlay.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
            overlay.style.zIndex = "9998";
            document.body.appendChild(overlay);

            const confirmBox = document.createElement("div");
            confirmBox.id = "confirmBox";
            confirmBox.style.position = "fixed";
            confirmBox.style.top = "50%";
            confirmBox.style.left = "50%";
            confirmBox.style.transform = "translate(-50%, -50%)";
            confirmBox.style.background = "#fff";
            confirmBox.style.border = "2px solid #16a34a";
            confirmBox.style.padding = "30px";
            confirmBox.style.borderRadius = "12px";
            confirmBox.style.boxShadow = "0 10px 30px rgba(0, 0, 0, 0.15)";
            confirmBox.style.zIndex = "9999";
            confirmBox.style.textAlign = "center";
            confirmBox.style.minWidth = "320px";
            confirmBox.innerHTML = `
                <p style="font-size: 16px; margin-bottom: 20px;">
                    <span style="font-size: 20px;">‚ö†Ô∏è</span> B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?
                </p>
                <div style="display: flex; justify-content: center; gap: 20px;">
                    <button onclick="window.location.href='/logout'; removeLogoutElements()"
                            style="background-color: #10b981; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        ‚úÖ C√≥
                    </button>
                    <button onclick="removeLogoutElements()"
                            style="background-color: #ef4444; color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        ‚ùå Kh√¥ng
                    </button>
                </div>
            `;
            document.body.appendChild(confirmBox);
        }

        function removeLogoutElements() {
            const confirmBox = document.getElementById("confirmBox");
            const overlay = document.getElementById("logoutOverlay");
            if (confirmBox) {
                confirmBox.remove();
            }
            if (overlay) {
                overlay.remove();
            }
        }
    </script>
</body>
</html>